<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Blog Content Pipeline v3</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --border: #e2e8f0; }
        body { font-family: 'Inter', system-ui, sans-serif; line-height: 1.6; padding: 2rem; background: var(--bg); color: #1e293b; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .box { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; display: flex; flex-direction: column; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        h1 { grid-column: 1 / -1; font-size: 1.5rem; font-weight: 800; margin-bottom: 1rem; color: #0f172a; }
        #dropzone { height: 500px; border: 2px dashed #cbd5e1; border-radius: 8px; margin-top: 12px; padding: 20px; outline: none; overflow-y: auto; color: #64748b; }
        #dropzone:focus { border-color: var(--primary); background: #f1f5f9; }
        .preview { width: 100%; height: 500px; margin-top: 12px; border: 1px solid var(--border); border-radius: 8px; padding: 15px; font-family: 'Fira Code', monospace; font-size: 13px; background: #0f172a; color: #e2e8f0; overflow-y: auto; white-space: pre-wrap; box-sizing: border-box; }
        .label { font-weight: 700; font-size: 0.75rem; text-transform: uppercase; color: #64748b; }
    </style>
</head>
<body>

    <h1>Blog Pipeline: Word → Semantic HTML</h1>

    <div class="container">
        <div class="box">
            <div class="label">Paste Word Content Here</div>
            <div id="dropzone" contenteditable="true">Ready for input...</div>
        </div>

        <div class="box">
            <div class="label">Cleaned Jodit-Ready HTML</div>
            <div id="output" class="preview"></div>
        </div>
    </div>

    <script>
        const dropzone = document.getElementById('dropzone');
        const output = document.getElementById('output');

        dropzone.addEventListener('paste', (e) => {
            e.preventDefault();
            const html = e.clipboardData.getData('text/html');
            if (html) {
                const result = processWordHTML(html);
                output.textContent = result;
                dropzone.innerHTML = `<div style="color:green">✔ Content converted!</div>`;
            }
        });

        function processWordHTML(rawHtml) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(rawHtml, 'text/html');
            
            // Cleanup metadata and comments
            const comments = doc.createTreeWalker(doc.body, NodeFilter.SHOW_COMMENT);
            while(comments.nextNode()) comments.currentNode.remove();

            return Array.from(doc.body.childNodes)
                .map(node => transformNode(node))
                .filter(item => item !== null && item !== '')
                .join('\n');
        }

        function transformNode(node) {
            // 1. Handle Text Nodes
            if (node.nodeType === 3) {
                const text = node.textContent.trim();
                return text ? text : null;
            }

            if (node.nodeType !== 1) return null;

            const tag = node.tagName.toLowerCase();
            const style = node.getAttribute('style') || '';
            const fontSize = parseFloat(style.match(/font-size:\s?(\d+(\.\d+)?)pt/)?.[1] || 0) * 1.33;
            const isBold = style.includes('font-weight:700') || style.includes('bold') || ['b', 'strong'].includes(tag);

            // 2. Heading Detection (Mapping Logic)
            let targetTag = null;
            
            // Check Font Size rules first (High Priority)
            if (isBold && fontSize >= 24) targetTag = 'h2';
            else if (isBold && fontSize >= 19) targetTag = 'h3';
            else if (isBold && fontSize >= 16) targetTag = 'h4';
            // Check explicit tags (Fallback)
            else if (tag === 'h1') targetTag = 'h2';
            else if (tag === 'h2') targetTag = 'h2';
            else if (tag === 'h3') targetTag = 'h3';
            else if (tag === 'h4') targetTag = 'h4';
            // Explicit paragraphs or blocks
            else if (['p', 'blockquote', 'ul', 'ol', 'li', 'table', 'tr', 'td', 'th'].includes(tag)) {
                targetTag = tag;
            }

            // 3. Process Block Elements
            if (targetTag) {
                const innerHTML = processInline(node);
                if (!innerHTML.trim()) return null;
                return `<${targetTag}>${innerHTML}</${targetTag}>`;
            }

            // 4. Handle BR
            if (tag === 'br') return '<br />';

            // 5. Recursive pass-through for generic containers (div, span)
            return Array.from(node.childNodes).map(transformNode).join('');
        }

        function processInline(parentNode) {
            let html = '';
            
            parentNode.childNodes.forEach(node => {
                if (node.nodeType === 3) {
                    html += node.textContent;
                } else if (node.nodeType === 1) {
                    const tag = node.tagName.toLowerCase();
                    const style = node.getAttribute('style') || '';
                    
                    let content = processInline(node);
                    if (!content) return;

                    // Apply Bold/Strong
                    if (['strong', 'b'].includes(tag) || style.includes('font-weight:700') || style.includes('bold')) {
                        content = `<strong>${content}</strong>`;
                    }
                    // Apply Italic/Em
                    if (['em', 'i'].includes(tag) || style.includes('font-style:italic')) {
                        content = `<em>${content}</em>`;
                    }
                    // Apply Underline
                    if (['u'].includes(tag) || style.includes('text-decoration:underline')) {
                        content = `<u>${content}</u>`;
                    }
                    
                    // Specific tag handling
                    if (tag === 'br') html += '<br />';
                    else html += content;
                }
            });
            
            // Clean up redundant nested tags like <strong><strong></strong></strong>
            return html.replace(/<strong><strong>/g, '<strong>').replace(/<\/strong><\/strong>/g, '</strong>');
        }
    </script>
</body>
</html>
